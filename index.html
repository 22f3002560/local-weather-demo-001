<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>City Weather (Open‑Meteo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Simple weather lookup using Open-Meteo APIs">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .result-card { display:none; }
    .spinner { display:none; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <div class="text-center mb-4">
          <h1 class="h3 fw-bold">Current Weather</h1>
          <p class="text-muted mb-0">Enter a city to see its current temperature and humidity (via Open‑Meteo).</p>
        </div>

        <form id="weather-form" class="card shadow-sm">
          <div class="card-body">
            <div class="mb-3">
              <label for="city" class="form-label">City name</label>
              <div class="input-group">
                <input type="text" id="city" class="form-control" placeholder="e.g., London, Tokyo, New York" required>
                <button class="btn btn-primary" type="submit" id="fetch-btn">Get Weather</button>
              </div>
            </div>
            <div id="feedback" class="visually-hidden" aria-live="polite"></div>
            <div class="d-flex align-items-center gap-2 spinner">
              <div class="spinner-border text-primary" role="status" aria-hidden="true" style="width:1.5rem;height:1.5rem;"></div>
              <span class="text-muted">Fetching weather…</span>
            </div>
          </div>
        </form>

        <div id="result" class="card shadow-sm mt-4 result-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
              <div>
                <h2 id="place" class="h5 mb-1"></h2>
                <div id="coords" class="text-muted small"></div>
              </div>
              <span id="time" class="badge text-bg-light"></span>
            </div>
            <hr>
            <div class="row text-center">
              <div class="col-6">
                <div class="display-6" id="temp"></div>
                <div class="text-muted">Temperature</div>
              </div>
              <div class="col-6">
                <div class="display-6" id="humidity"></div>
                <div class="text-muted">Humidity</div>
              </div>
            </div>
          </div>
        </div>

        <div id="alert-wrap" class="mt-4"></div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('weather-form');
    const cityInput = document.getElementById('city');
    const spinner = document.querySelector('.spinner');
    const resultCard = document.getElementById('result');
    const alertWrap = document.getElementById('alert-wrap');
    const feedback = document.getElementById('feedback');

    const el = {
      place: document.getElementById('place'),
      coords: document.getElementById('coords'),
      time: document.getElementById('time'),
      temp: document.getElementById('temp'),
      humidity: document.getElementById('humidity'),
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const city = cityInput.value.trim();
      clearAlert();
      if (!city) {
        showAlert('Please enter a city name.', 'warning');
        return;
      }
      setLoading(true);
      try {
        const loc = await geocodeCity(city);
        const weather = await fetchWeather(loc.latitude, loc.longitude);
        renderResult(loc, weather);
      } catch (err) {
        showAlert(err.message || 'Something went wrong. Please try again.', 'danger');
        resultCard.style.display = 'none';
      } finally {
        setLoading(false);
      }
    });

    async function geocodeCity(name) {
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Failed to look up the city. Please try again later.');
      const data = await res.json();
      if (!data.results || data.results.length === 0) {
        throw new Error('City not found. Please check the spelling or try a different city.');
      }
      return data.results[0];
    }

    async function fetchWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&timezone=auto`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Failed to fetch weather data.');
      return res.json();
    }

    function renderResult(loc, data) {
      const t = data.current?.temperature_2m;
      const h = data.current?.relative_humidity_2m;
      const tu = data.current_units?.temperature_2m || '°C';
      const hu = data.current_units?.relative_humidity_2m || '%';
      const time = data.current?.time;

      el.place.textContent = formatPlace(loc);
      el.coords.textContent = `Lat: ${loc.latitude.toFixed(2)}, Lon: ${loc.longitude.toFixed(2)}`;
      el.time.textContent = time ? `As of ${time}` : '';

      el.temp.textContent = (typeof t === 'number') ? `${t} ${tu}` : '—';
      el.humidity.textContent = (typeof h === 'number') ? `${h} ${hu}` : '—';

      resultCard.style.display = 'block';
      feedback.classList.remove('visually-hidden');
      feedback.textContent = 'Weather loaded.';
      setTimeout(() => feedback.classList.add('visually-hidden'), 1500);
    }

    function formatPlace(loc) {
      const parts = [
        loc.name,
        loc.admin1,
        loc.country_code ? `(${loc.country_code})` : loc.country
      ].filter(Boolean);
      // Avoid duplicate country info if both provided
      return dedupeParts(parts).join(' ');
    }

    function dedupeParts(parts) {
      return parts.filter((p, i) => parts.indexOf(p) === i);
    }

    function setLoading(isLoading) {
      spinner.style.display = isLoading ? 'flex' : 'none';
      form.querySelectorAll('input, button').forEach(el => el.disabled = isLoading);
    }

    function showAlert(message, type = 'info') {
      clearAlert();
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show`;
      alert.role = 'alert';
      alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      `;
      alertWrap.appendChild(alert);
    }

    function clearAlert() {
      alertWrap.innerHTML = '';
    }

    // Optional: focus the input on load for convenience
    window.addEventListener('DOMContentLoaded', () => {
      cityInput.focus();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>